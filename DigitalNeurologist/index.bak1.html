<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Digital Neurologist</title>
  <!-- Tailwind CSS (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React + ReactDOM (CDN) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel (so we can run JSX directly in the browser) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    /* Smooth font */
    html, body { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-slate-50 to-slate-100 text-slate-900">
  <div id="root"></div>

  <script type="text/babel">
    const { useEffect, useMemo, useState } = React;

    /** CSV helpers **/
    function parseCSV(text) {
      const rows = [];
      let row = [];
      let field = "";
      let inQuotes = false;
      for (let i = 0; i < text.length; i++) {
        const ch = text[i];
        if (inQuotes) {
          if (ch === '"') {
            if (text[i + 1] === '"') { field += '"'; i++; }
            else { inQuotes = false; }
          } else {
            field += ch;
          }
          continue;
        }
        if (ch === '"') { inQuotes = true; continue; }
        if (ch === ',') { row.push(field); field = ""; continue; }
        if (ch === '\n' || ch === '\r') {
          row.push(field); field = "";
          if (row.length && !(row.length === 1 && row[0] === "")) rows.push(row);
          row = [];
          if (ch === '\r' && text[i + 1] === '\n') i++;
          continue;
        }
        field += ch;
      }
      row.push(field);
      if (row.some(c => c !== "")) rows.push(row);
      if (!rows.length) return [];
      const header = rows[0].map(h => h.trim());
      return rows.slice(1).map(arr => {
        const obj = {};
        header.forEach((h, idx) => obj[h] = (arr[idx] || "").trim());
        return obj;
      });
    }

    function toCSV(rows, columns) {
      const esc = (s = "") => {
        const str = String(s);
        if (/[,"\n\r]/.test(str)) return '"' + str.replace(/"/g, '""') + '"';
        return str;
      };
      const header = columns.map(esc).join(",");
      const body = rows.map(r => columns.map(c => esc(r[c])).join(",")).join("\\n");
      return header + "\\n" + body + "\\n";
    }

    function parseMulti(val) {
      if (!val) return [];
      return String(val).split(/[;|\\/]+/).map(s => s.trim()).filter(Boolean);
    }
    const normalize = s => String(s || "").trim().toLowerCase();

    /** Localization tree (from your diagram) **/
    const LOCALIZATION_TREE = [
      {
        label: "Central nervous system",
        children: [
          { label: "Cerebral hemisphere", children: [
            { label: "Cortex" },
            { label: "Subcortical white matter" },
            { label: "Basal ganglia" },
            { label: "Thalamus" },
          ]},
          { label: "Brainstem", children: [ { label: "Midbrain" }, { label: "Pons" }, { label: "Medulla" } ] },
          { label: "Cerebellum", children: [ { label: "Hemisphere" }, { label: "Midline" } ] },
          { label: "Spinal cord", children: [
            { label: "Corticospinal tracts" },
            { label: "Spinothalamic tracts" },
            { label: "Dorsal columns" },
          ]},
          { label: "Spinal roots", children: [ { label: "Cervical" }, { label: "Thoracic" }, { label: "Lumbar" } ] },
        ]
      },
      {
        label: "Peripheral nervous system",
        children: [
          { label: "Dorsal root ganglia" }, // selectable leaf
          { label: "Plexus", children: [ { label: "Brachial" }, { label: "Lumbosacral" } ] },
          { label: "Peripheral nerves", children: [ { label: "Axon" }, { label: "Myelin" } ] },
          { label: "Neuromuscular junction", children: [ { label: "Pre-synaptic" }, { label: "Post-synaptic" } ] },
          { label: "Muscle", children: [ { label: "Proximal" }, { label: "Distal" } ] },
        ]
      }
    ];
    function flattenLeaves(nodes, parentPath = []) {
      const out = [];
      for (const n of nodes) {
        const path = [...parentPath, n.label];
        if (!n.children || n.children.length === 0) out.push({ label: n.label, path });
        else out.push(...flattenLeaves(n.children, path));
      }
      return out;
    }
    const LOCALIZATION_LEAVES = flattenLeaves(LOCALIZATION_TREE).map(x => x.label);
    const PNS_LEAVES = new Set(flattenLeaves(LOCALIZATION_TREE.filter(n => n.label === "Peripheral nervous system")).map(x => x.label));

    /** Pace & pattern **/
    const PACE_TIME = ["Hyperacute", "Acute", "Subacute", "Chronic"];
    const PACE_PATTERN = ["Unknown", "Monophasic", "Relapsing", "Stepwise", "Progressive"];

    /** Etiologies (categories only) **/
    const ETIOLOGY_UI = ["Vascular", "Seizure", "Migraine", "Inflammatory/Autoimmune", "Infectious", "Neoplastic", "Degenerative", "Toxic", "Metabolic"];
    const etiCanonical = name => {
      const n = (name || "").toLowerCase();
      if (n.includes("vascular")) return "vascular";
      if (n.includes("seiz")) return "seizure";
      if (n.includes("migra")) return "migraine";
      if (n.includes("infect")) return "infectious";
      if (n.includes("auto") || n.includes("inflamm")) return "autoimmune";
      if (n.includes("neoplas") || n.includes("tumor")) return "neoplastic";
      if (n.includes("degener")) return "degenerative";
      if (n.includes("toxic")) return "toxic";
      if (n.includes("metabol")) return "metabolic";
      return n;
    };

    // Matrix from the mayo-inspired grid; Hyperacute -> Acute
    const ETIOL_MATRIX = {
      Acute: { focal: ["vascular", "seizure", "migraine"], diffuse: ["vascular", "seizure", "metabolic", "toxic"] },
      Subacute: { focal: ["autoimmune", "infectious"], diffuse: ["autoimmune", "infectious"] },
      Chronic: { focal: ["neoplastic", "degenerative"], diffuse: ["degenerative", "metabolic", "toxic"] },
    };

    function deriveFocality(localizations) {
      if (!localizations || !localizations.length) return null;
      const anyPNS = localizations.some(l => PNS_LEAVES.has(l));
      return anyPNS ? "diffuse" : "focal";
    }
    function etiologyOptionsFor(paceTimecourse, localizationPicks) {
      if (!paceTimecourse || !localizationPicks || localizationPicks.length === 0) return [...ETIOLOGY_UI];
      const group = paceTimecourse === "Subacute" ? "Subacute" : (paceTimecourse === "Chronic" ? "Chronic" : "Acute");
      const foc = deriveFocality(localizationPicks) || "focal";
      const allowedCanon = ETIOL_MATRIX[group][foc];
      const allowedSet = new Set(allowedCanon);
      return ETIOLOGY_UI.filter(label => allowedSet.has(etiCanonical(label)));
    }

    /** Mapping from arbitrary CSV headers to our fields **/
    function lowerKeys(row) { const out = {}; Object.keys(row).forEach(k => out[k.toLowerCase()] = row[k]); return out; }
    function mapRows(raw) {
      return raw.map((r, i) => {
        const x = lowerKeys(r);
        return {
          id: x.id || String(i + 1),
          prompt: x.prompt || x.case || "",
          pace_timecourse: x.pace_timecourse || x.pace || "",
          pace_pattern: x.pace_pattern || x.pattern || "",
          localization: x.localization || "",
          etiology: x.etiology || "",
          disease: x.disease || "",
          explanation: x.explanation || x.explain || "",
          tags: x.tags || "",
        };
      });
    }

    /** Fallback sample data (used if external file is absent) **/
    const SAMPLE_CSV = `id,prompt,pace_timecourse,pace_pattern,localization,etiology,disease,explanation,tags
1,72F sudden left hemiparesis with gaze preference,Hyperacute,,Cortex,Vascular,Right MCA ischemic stroke,Hyperacute cortical deficits localize to contralateral MCA territory,stroke
2,23F subacute ascending paresthesias and weakness over days,Subacute,Monophasic,Spinal cord,Inflammatory/Autoimmune,Transverse myelitis,Longitudinally extensive lesions suggest inflammatory myelopathy,myelitis
`;

    /** UI bits **/
    function Section({ title, right, children }) {
      return (
        <div className="bg-white border border-gray-200 rounded-2xl shadow-sm">
          {(title || right) && (
            <div className="flex items-center justify-between px-4 py-3 border-b">
              {title ? <h3 className="font-semibold text-gray-800">{title}</h3> : <div />}
              {right}
            </div>
          )}
          <div className="p-4">{children}</div>
        </div>
      );
    }

    function App() {
      const [usingExternal, setUsingExternal] = useState(false);
      const [loadError, setLoadError] = useState(null);
      const [data, setData] = useState(() => mapRows(parseCSV(SAMPLE_CSV)));
      const [currentIdx, setCurrentIdx] = useState(0);
      const [showExplain, setShowExplain] = useState(false);

      // auto-fetch digitalneurologist-cases.csv (may fail under file://)
      useEffect(() => {
        (async () => {
          try {
            const res = await fetch("digitalneurologist-cases.csv", { cache: "no-store" });
            if (res.ok) {
              const txt = await res.text();
              const rows = mapRows(parseCSV(txt));
              if (rows && rows.length) {
                setData(rows);
                setUsingExternal(true);
                setLoadError(null);
                setCurrentIdx(0);
              }
            }
          } catch (e) {
            setLoadError("Could not auto-load digitalneurologist-cases.csv (this is expected if opened via file://). Use Load CSV.");
          }
        })();
      }, []);

      function onPickCSVFile(file) {
        const reader = new FileReader();
        reader.onload = () => {
          try {
            const txt = String(reader.result || "");
            const rows = mapRows(parseCSV(txt));
            if (rows && rows.length) {
              setData(rows);
              setUsingExternal(true);
              setCurrentIdx(0);
              setShowExplain(false);
              setLoadError(null);
            } else {
              setLoadError("CSV parsed but no rows found.");
            }
          } catch {
            setLoadError("Could not parse CSV.");
          }
        };
        reader.readAsText(file);
      }

      const order = useMemo(() => Array.from({ length: data.length }, (_, i) => i), [data]);

      const currentCase = useMemo(() => {
        if (!order.length) return null;
        return data[order[Math.min(currentIdx, order.length - 1)]];
      }, [data, order, currentIdx]);

      const [picked, setPicked] = useState({
        pace_timecourse: null,
        pace_pattern: null,
        localization: [],
        etiology: [],
        disease: null,
      });
      const [locked, setLocked] = useState({ pace_timecourse: false, localization: false, etiology: false, disease: false });

      useEffect(() => {
        setPicked({ pace_timecourse: null, pace_pattern: null, localization: [], etiology: [], disease: null });
        setLocked({ pace_timecourse: false, localization: false, etiology: false, disease: false });
        setShowExplain(false);
      }, [currentIdx, order.length]);

      const diseaseOptions = useMemo(() => {
        if (!data?.length || !currentCase) return [];
        const all = Array.from(new Set(data.map(d => d.disease).filter(Boolean)));
        const others = all.filter(n => n !== currentCase.disease);
        const distractors = others.sort(() => Math.random() - 0.5).slice(0, Math.max(3, Math.min(7, others.length)));
        const mix = [currentCase.disease, ...distractors].sort(() => Math.random() - 0.5);
        return mix;
      }, [data, currentCase]);

      const etiologyOptions = useMemo(() => etiologyOptionsFor(picked.pace_timecourse, picked.localization), [picked.pace_timecourse, picked.localization]);

      const stepList = [
        { key: "pace_timecourse", label: "Pace", options: PACE_TIME },
        { key: "localization", label: "Localization", options: LOCALIZATION_LEAVES },
        { key: "etiology", label: "Etiology", options: etiologyOptions },
        { key: "disease", label: "Disease", options: diseaseOptions },
      ];
      const activeStepIndex = stepList.findIndex(s => !locked[s.key]);
      const isFinished = stepList.every(s => locked[s.key]);

      function onPick(stepKey, value) {
        if (!currentCase) return;
        if (stepKey === "localization") {
          setPicked(prev => {
            const has = new Set(prev.localization || []);
            if (has.has(value)) has.delete(value); else has.add(value);
            return { ...prev, localization: Array.from(has) };
          });
          return;
        }
        if (stepKey === "etiology") {
          setPicked(prev => {
            const has = new Set(prev.etiology || []);
            if (has.has(value)) has.delete(value); else has.add(value);
            return { ...prev, etiology: Array.from(has) };
          });
          return;
        }
        if (stepKey === "disease") {
          setPicked(p => ({ ...p, disease: value }));
          return;
        }
        if (stepKey === "pace_timecourse") {
          setPicked(p => ({ ...p, pace_timecourse: value }));
          return;
        }
      }
      const onPickPattern = (value) => setPicked(p => ({ ...p, pace_pattern: value }));

      function confirmPace() { if (!picked.pace_timecourse) return; setLocked(l => ({ ...l, pace_timecourse: true })); }
      function confirmLocalization() { if (!picked.localization.length) return; setLocked(l => ({ ...l, localization: true })); }
      function confirmEtiology() { if (!picked.etiology.length) return; setLocked(l => ({ ...l, etiology: true })); }
      function confirmDisease() { if (!picked.disease) return; setLocked(l => ({ ...l, disease: true })); }
      function nextCase() { if (!isFinished) return; if (currentIdx + 1 < order.length) setCurrentIdx(i => i + 1); else setShowExplain(true); }

      const paceTone = (opt) => ({
        Hyperacute: "bg-rose-100 border-rose-200 hover:bg-rose-200",
        Acute: "bg-orange-100 border-orange-200 hover:bg-orange-200",
        Subacute: "bg-amber-100 border-amber-200 hover:bg-amber-200",
        Chronic: "bg-emerald-100 border-emerald-200 hover:bg-emerald-200",
      }[opt] || "bg-white border-slate-300 hover:bg-slate-50");

      function LocalizationPicker() {
        return (
          <div className="w-full max-w-3xl mx-auto flex flex-col gap-4">
            {LOCALIZATION_TREE.map(branch => (
              <div key={branch.label} className="w-full">
                <div className="text-sm font-semibold text-slate-700 mb-2 text-center">{branch.label}</div>
                {branch.children?.map(group => (
                  <div key={group.label} className="mb-3 w-full">
                    <div className="text-xs uppercase tracking-wide text-slate-500 mb-2 text-center">{group.label}</div>
                    {group.children && group.children.length > 0 ? (
                      <div className="flex flex-wrap justify-center gap-2">
                        {group.children.map(leaf => {
                          const opt = leaf.label;
                          const isPicked = picked.localization.includes(opt);
                          return (
                            <button
                              key={opt}
                              onClick={() => onPick("localization", opt)}
                              className={`px-3 py-2 rounded-xl border text-sm w-auto ${isPicked ? "bg-indigo-600 text-white border-indigo-700" : "bg-white hover:bg-indigo-50 border-slate-300"}`}
                            >{opt}</button>
                          );
                        })}
                      </div>
                    ) : (
                      <div className="flex justify-center">
                        {(() => {
                          const opt = group.label;
                          const isPicked = picked.localization.includes(opt);
                          return (
                            <button
                              onClick={() => onPick("localization", opt)}
                              className={`px-3 py-2 rounded-xl border text-sm w-auto ${isPicked ? "bg-indigo-600 text-white border-indigo-700" : "bg-white hover:bg-indigo-50 border-slate-300"}`}
                            >{opt}</button>
                          );
                        })()}
                      </div>
                    )}
                  </div>
                ))}
              </div>
            ))}
          </div>
        );
      }

      return (
        <div className="max-w-6xl mx-auto p-4 md:p-6">
          {/* Header + CSV loader */}
          <div className="flex flex-col items-center gap-3 mb-4">
            <h1 className="text-2xl font-bold tracking-tight">The Digital Neurologist</h1>
            <div className="flex items-center gap-2 text-xs">
              <label htmlFor="csv-file" className="px-3 py-1.5 rounded-full border bg-white hover:bg-indigo-50 cursor-pointer">Load CSV</label>
              <input id="csv-file" type="file" accept=".csv" className="hidden" onChange={(e) => e.target.files && e.target.files[0] && onPickCSVFile(e.target.files[0])} />
              <span className={`px-2 py-1 rounded-full border ${usingExternal ? "bg-emerald-50 border-emerald-200 text-emerald-700" : "bg-slate-50 border-slate-200 text-slate-600"}`}>
                {usingExternal ? "Using external CSV" : "Using sample dataset"}
              </span>
              {loadError ? <span className="text-rose-600">{loadError}</span> : null}
            </div>
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-3 gap-4">
            {/* LEFT: Case (sticky) */}
            <div className="lg:col-span-1">
              <div className="sticky top-4 flex flex-col gap-3">
                <Section title={null} right={null}>
                  {/* Next Case button over prompt */}
                  <div className="flex items-center justify-end mb-2">
                    <button
                      disabled={!isFinished}
                      onClick={nextCase}
                      className={`px-4 py-2 rounded-xl text-sm shadow-sm border ${isFinished ? "bg-indigo-600 text-white hover:bg-indigo-700 border-indigo-700" : "bg-white text-slate-400 border-slate-300 cursor-not-allowed"}`}
                    >Next Case</button>
                  </div>
                  {!currentCase ? (
                    <div className="text-sm text-slate-600">Load a CSV or start with the sample cases. Begin by choosing <strong>Pace</strong> on the right.</div>
                  ) : (
                    <div className="p-4 bg-white/70 backdrop-blur border rounded-2xl">
                      <div className="text-xs uppercase tracking-wide text-slate-500 mb-1">Prompt</div>
                      <div className="text-lg leading-6">{currentCase.prompt}</div>
                    </div>
                  )}
                </Section>

                <Section title="Your working picks" right={null}>
                  <div className="grid grid-cols-2 gap-2">
                    <div className="p-3 rounded-xl border bg-white">
                      <div className="text-[10px] uppercase tracking-wide text-slate-500">Pace</div>
                      <div className="mt-1 text-sm font-medium">{picked.pace_timecourse || "—"}</div>
                    </div>
                    <div className="p-3 rounded-xl border bg-white">
                      <div className="text-[10px] uppercase tracking-wide text-slate-500">Pattern (optional)</div>
                      <div className="mt-1 text-sm font-medium">{picked.pace_pattern || "Unknown"}</div>
                    </div>
                    <div className="p-3 rounded-xl border bg-white">
                      <div className="text-[10px] uppercase tracking-wide text-slate-500">Localization</div>
                      <div className="mt-1 text-sm font-medium">{picked.localization.length ? picked.localization.join(", ") : "—"}</div>
                    </div>
                    <div className="p-3 rounded-xl border bg-white">
                      <div className="text-[10px] uppercase tracking-wide text-slate-500">Etiology</div>
                      <div className="mt-1 text-sm font-medium">{picked.etiology.length ? picked.etiology.join(", ") : "—"}</div>
                    </div>
                    <div className="p-3 rounded-xl border bg-white col-span-2">
                      <div className="text-[10px] uppercase tracking-wide text-slate-500">Disease</div>
                      <div className="mt-1 text-sm font-medium">{picked.disease || "—"}</div>
                    </div>
                  </div>
                </Section>
              </div>
            </div>

            {/* RIGHT: steps */}
            <div className="lg:col-span-2 flex flex-col gap-4">
              <Section title={null} right={null}>
                {!currentCase ? (
                  <div className="text-sm text-slate-600 text-center">Use a CSV or the sample dataset to try the flow.</div>
                ) : (
                  <div className="flex flex-col gap-4 items-center">
                    {/* Stepper */}
                    <div className="flex flex-wrap gap-2 justify-center">
                      {["Pace", "Localization", "Etiology", "Disease"].map((label, idx) => {
                        const done = idx < activeStepIndex;
                        const isActive = idx === activeStepIndex && !isFinished;
                        return (
                          <div key={label} className={`px-3 py-1 rounded-full text-xs border ${isActive ? "bg-indigo-600 text-white border-indigo-700" : (done ? "bg-emerald-50 text-emerald-700 border-emerald-200" : "bg-white")}`}>
                            {done ? "✓ " : isActive ? "• " : ""}{label}
                          </div>
                        );
                      })}
                    </div>

                    {/* Pace */}
                    {!locked.pace_timecourse && (
                      <div className="w-full max-w-3xl mx-auto">
                        <div className="flex flex-wrap justify-center gap-2">
                          {PACE_TIME.map(opt => (
                            <button key={opt} onClick={() => onPick("pace_timecourse", opt)} className={`px-3 py-2 rounded-xl border text-sm w-auto ${paceTone(opt)}`}>{opt}</button>
                          ))}
                        </div>
                        <div className="mt-4">
                          <div className="mb-2 text-xs uppercase tracking-wide text-slate-500 text-center">Pattern (optional)</div>
                          <div className="flex flex-wrap gap-2 justify-center">
                            {PACE_PATTERN.map(opt => (
                              <button key={opt} onClick={() => onPickPattern(opt)} className={`px-3 py-1.5 rounded-full border text-xs ${picked.pace_pattern === opt ? "bg-indigo-600 text-white border-indigo-700" : "bg-white hover:bg-indigo-50 border-slate-300 text-slate-700"}`}>{opt}</button>
                            ))}
                          </div>
                        </div>
                        <div className="mt-3 flex justify-center">
                          <button disabled={!picked.pace_timecourse} onClick={confirmPace} className={`px-4 py-2 rounded-xl text-sm shadow-sm border ${picked.pace_timecourse ? "bg-indigo-600 text-white hover:bg-indigo-700 border-indigo-700" : "bg-white text-slate-400 border-slate-300 cursor-not-allowed"}`}>Paced!</button>
                        </div>
                      </div>
                    )}

                    {/* Localization */}
                    {locked.pace_timecourse && !locked.localization && (
                      <>
                        <LocalizationPicker />
                        <div className="mt-2 flex justify-center">
                          <button disabled={!picked.localization.length} onClick={confirmLocalization} className={`px-4 py-2 rounded-xl text-sm shadow-sm border ${picked.localization.length ? "bg-indigo-600 text-white border-indigo-700" : "bg-white text-slate-400 border-slate-300 cursor-not-allowed"}`}>Localized!</button>
                        </div>
                      </>
                    )}

                    {/* Etiology */}
                    {locked.localization && !locked.etiology && (
                      <div className="w-full max-w-3xl mx-auto">
                        <div className="flex flex-wrap justify-center gap-2">
                          {etiologyOptions.map(opt => {
                            const isPicked = picked.etiology.includes(opt);
                            return (
                              <button key={opt} onClick={() => onPick("etiology", opt)} className={`px-3 py-2 rounded-xl border text-sm w-auto ${isPicked ? "bg-indigo-600 text-white border-indigo-700" : "bg-white hover:bg-indigo-50 border-slate-300"}`}>{opt}</button>
                            );
                          })}
                        </div>
                        <div className="mt-2 flex justify-center">
                          <button disabled={!picked.etiology.length} onClick={confirmEtiology} className={`px-4 py-2 rounded-xl text-sm shadow-sm border ${picked.etiology.length ? "bg-indigo-600 text-white border-indigo-700" : "bg-white text-slate-400 border-slate-300 cursor-not-allowed"}`}>Etiologies!</button>
                        </div>
                      </div>
                    )}

                    {/* Disease */}
                    {locked.etiology && !locked.disease && (
                      <div className="w-full max-w-3xl mx-auto">
                        <div className="flex flex-wrap justify-center gap-2">
                          {diseaseOptions.map(opt => (
                            <button key={opt} onClick={() => onPick("disease", opt)} className={`px-3 py-2 rounded-xl border text-sm w-auto ${picked.disease === opt ? "bg-indigo-600 text-white border-indigo-700" : "bg-white hover:bg-indigo-50 border-slate-300"}`}>{opt}</button>
                          ))}
                        </div>
                        <div className="mt-2 flex justify-center">
                          <button disabled={!picked.disease} onClick={confirmDisease} className={`px-4 py-2 rounded-xl text-sm shadow-sm border ${picked.disease ? "bg-indigo-600 text-white border-indigo-700" : "bg-white text-slate-400 border-slate-300 cursor-not-allowed"}`}>Diagnosed!</button>
                        </div>
                      </div>
                    )}

                    {/* Completion */}
                    {isFinished && (
                      <div className="p-4 border rounded-2xl bg-emerald-50 border-emerald-200 w-full max-w-3xl">
                        <div className="font-semibold text-emerald-800">Case complete</div>
                        {currentCase.explanation ? (
                          <div className="text-sm text-emerald-900/90 mt-1">{currentCase.explanation}</div>
                        ) : (
                          <div className="text-sm text-emerald-900/80 mt-1">Great work. Review the flow, then continue from the left.</div>
                        )}
                      </div>
                    )}
                  </div>
                )}
              </Section>

              {showExplain && currentIdx + 1 >= order.length && (
                <Section title="Session Summary" right={null}>
                  <div className="text-sm text-slate-700">Session complete.</div>
                </Section>
              )}
            </div>
          </div>

          <footer className="mt-10 text-center text-xs text-slate-500">created by micah etter, md</footer>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
