<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Digital Neurologist — Flower Power Edition</title>
  <link rel="icon" href="favicon.png" type="image/png" />
  <style>
    /* ---------- 60s-esque Flower & Brain vibe (Austin Powers / Price Is Right) ---------- */
    :root{
      /* Groovy palette */
      --sun: #ffd54a;
      --hot: #ff4db8;
      --tangerine: #ff8a00;
      --sea: #00c2b2;
      --violet: #7b61ff;
      --ink: #0e0a1f;
      --paper: #fffaf1;
      --line: #1a102e;
      --chip: #fff4e0;
      --chip-border: #2c1d57;
      --good: #007a4b;
      --bad: #b00028;
      --shadow: rgba(26,16,46,.2);
      --radius-xl: 22px;
      --radius-lg: 18px;
      --radius: 14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: "Cooper Black", "Comic Sans MS", "Trebuchet MS", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: radial-gradient(1200px 700px at 20% 0%, #ffeab5 0%, #fffaf1 50%, #fffaf1 100%);
      color: var(--ink);
      text-rendering: optimizeLegibility;
    }

    /* Header banner with thick lines and flower/brain doodles */
    .banner{
      position: relative;
      padding: 22px 16px 28px;
      background:
        radial-gradient(circle at 8% 40%, var(--hot) 0 60px, transparent 61px),
        radial-gradient(circle at 18% 20%, var(--sun) 0 42px, transparent 43px),
        radial-gradient(circle at 88% 25%, var(--sea) 0 50px, transparent 51px),
        radial-gradient(circle at 82% 70%, var(--tangerine) 0 65px, transparent 66px),
        linear-gradient(90deg, #ffeab5 0%, #ffd1e7 40%, #c9fff6 60%, #ffe2b8 100%);
      border-bottom: 6px solid var(--line);
      box-shadow: 0 6px 0 0 var(--line), 0 14px 18px var(--shadow);
    }
    .title{
      margin: 0;
      text-align:center;
      font-size: clamp(24px, 4vw, 44px);
      line-height: 1;
      letter-spacing: .01em;
      color: var(--line);
      text-shadow: 1px 1px 0 #fff;
    }
    .subtitle{
      text-align:center;
      margin-top: 8px;
      font-weight: 800;
      color: var(--chip-border);
      letter-spacing: .12em;
      text-transform: uppercase;
    }
    .wrap{ max-width: 1180px; margin: 22px auto 56px; padding: 0 18px; }
    .grid{ display:grid; grid-template-columns: 380px 1fr; gap:28px; align-items:start; }
    @media (max-width: 980px){ .grid{ grid-template-columns: 1fr; } }

    /* Cards with chunky borders and rounded corners */
    .card{
      background: var(--paper);
      border: 6px solid var(--line);
      border-radius: var(--radius-xl);
      padding: 16px;
      box-shadow:
        0 12px 0 0 var(--line),
        0 24px 28px var(--shadow);
      position: relative;
      overflow: hidden;
    }
    .card:before{
      content: "";
      position: absolute; inset: 0;
      background:
        radial-gradient(circle at 12% -10%, rgba(255,77,184,.10) 0 120px, transparent 121px),
        radial-gradient(circle at 100% 10%, rgba(0,194,178,.10) 0 140px, transparent 141px);
      pointer-events: none;
    }

    /* Labels */
    .muted-title{ font-size:11px; text-transform:uppercase; letter-spacing:.14em; color: var(--chip-border); }
    .section-title{ text-align:center; font-size:13px; text-transform:uppercase; color: var(--chip-border); margin: 8px 0 6px; letter-spacing:.16em; }
    .section-header{ text-align:center; font-weight:900; margin:12px 0 6px; font-size: 18px; color: var(--line); text-transform: uppercase; letter-spacing:.12em; }

    /* Case and summary */
    .case-pill{
      background: #ffffff;
      border: 4px solid var(--line);
      border-radius: 18px;
      padding: 12px 14px;
      box-shadow: 0 4px 0 var(--line), 0 8px 16px var(--shadow);
    }

    .case-box{ min-height:220px; white-space:pre-wrap; font-weight:700; font-size: 18px; line-height:1.4; }
    .summary-grid{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    .summary-item{
      background: #fff5e8;
      border: 4px solid var(--line);
      border-radius: var(--radius-lg);
      padding: 10px 12px;
      min-height: 66px;
      box-shadow: inset 0 -4px 0 #ffd8b5;
    }
    .value{ margin-top:4px; font-weight:800; font-size: 16px; }
    .dash{ color:#9c8db8 }

    /* Tabs */
    .stage-tabs{ display:flex; gap:10px; justify-content:center; margin: 2px 0 14px; flex-wrap:wrap;}
    .tab{
      font-size:14px; padding:10px 16px;
      border-radius: 999px;
      border: 4px solid var(--line);
      background: linear-gradient(180deg, #fff 0%, #ffe7fb 100%);
      color: var(--line); cursor: pointer;
      box-shadow: 0 4px 0 var(--line);
      font-weight:900;
    }
    .tab.active{
      background: linear-gradient(180deg, #ffe166 0%, #ffc400 100%);
      box-shadow: 0 4px 0 var(--line), 0 0 0 6px #fff inset;
    }

    /* Option chips: chunky, bubbly, with thick lines */
    .options{ display:flex; flex-wrap:wrap; gap:10px; justify-content:center; }
    .chip{
      padding: 11px 16px;
      border: 4px solid var(--line);
      border-radius: 999px;
      background: var(--chip);
      color: var(--line);
      font-size: 15px; font-weight: 900; letter-spacing:.02em;
      cursor:pointer; transition: transform .06s ease, filter .15s ease;
      box-shadow: 0 4px 0 var(--line), 0 8px 18px var(--shadow);
    }
    .chip:hover{ transform: translateY(-1px); filter: saturate(1.1); }
    .chip.active{ background: #d8d0ff; }
    .chip.disabled{ color: #8c7fb3; cursor:not-allowed; background:#eee6ff; }
    .chip.correct{
      background: #ccffe8; color: var(--good); text-decoration: underline;
      border-color: #064e3b;
      box-shadow: 0 4px 0 #064e3b, 0 8px 18px var(--shadow);
    }
    .chip.wrong{
      background: #ffe0ea; color: var(--bad); text-decoration: line-through;
      border-color: #7a0018;
      box-shadow: 0 4px 0 #7a0018, 0 8px 18px var(--shadow);
    }

    /* Controls */
    .controls{ display:flex; justify-content:center; margin-top:12px; gap:10px; flex-wrap: wrap; }
    .btn{
      background: linear-gradient(180deg, #ffeb99 0%, #ffd54a 100%);
      color: var(--line);
      border: 4px solid var(--line);
      border-radius: 16px;
      padding: 11px 16px; cursor:pointer; font-weight: 900; letter-spacing:.02em;
      box-shadow: 0 6px 0 var(--line), 0 10px 18px var(--shadow);
    }
    .btn:disabled{ opacity:.5; cursor:not-allowed; }
    .btn:active{ transform: translateY(2px); box-shadow: 0 4px 0 var(--line); }

    /* Footer */
    .footer{ text-align:center; margin-top:12px; font-size:12px; color: var(--chip-border); font-weight:700; }

    /* Decorative corner flowers (SVG background shapes) */
    .card .flower{
      position:absolute; width:120px; height:120px; opacity:.18; pointer-events:none;
      filter: saturate(1.2);
    }
    .flower.fl1{ top:-16px; left:-16px; transform: rotate(-10deg); }
    .flower.fl2{ bottom:-10px; right:-14px; transform: rotate(20deg); }
  </style>
</head>
<body>
  <div class="banner">
    <h1 class="title">The Digital Neurologist</h1>
  </div>

  <div class="wrap">
    <div class="grid">
      <!-- LEFT: Case + Summary -->
      <div class="card">
        <svg class="flower fl1" viewBox="0 0 100 100" aria-hidden="true">
          <g stroke="var(--line)" stroke-width="6" fill="var(--hot)">
            <circle cx="50" cy="18" r="16"/><circle cx="82" cy="34" r="16"/>
            <circle cx="82" cy="66" r="16"/><circle cx="50" cy="82" r="16"/>
            <circle cx="18" cy="66" r="16"/><circle cx="18" cy="34" r="16"/>
            <circle cx="50" cy="50" r="14" fill="var(--sun)"/>
          </g>
        </svg>
        <svg class="flower fl2" viewBox="0 0 100 100" aria-hidden="true">
          <g stroke="var(--line)" stroke-width="6" fill="var(--sea)">
            <circle cx="50" cy="18" r="16"/><circle cx="82" cy="34" r="16"/>
            <circle cx="82" cy="66" r="16"/><circle cx="50" cy="82" r="16"/>
            <circle cx="18" cy="66" r="16"/><circle cx="18" cy="34" r="16"/>
            <circle cx="50" cy="50" r="14" fill="var(--tangerine)"/>
          </g>
        </svg>

        <div class="muted-title">Case</div>
        <div id="caseBox" class="case-box value case-pill"></div>

        <div class="summary-grid" style="margin-top:12px">
          <div class="summary-item">
            <div class="muted-title">Pace</div>
            <div id="sumPace" class="value dash">—</div>
          </div>
          <div class="summary-item">
            <div class="muted-title">Pattern</div>
            <div id="sumPattern" class="value dash">—</div>
          </div>
          <div class="summary-item">
            <div class="muted-title">Localization</div>
            <div id="sumLoc" class="value dash">—</div>
          </div>
          <div class="summary-item">
            <div class="muted-title">Etiology</div>
            <div id="sumEti" class="value dash">—</div>
          </div>
          <div class="summary-item" style="grid-column:1/3">
            <div class="muted-title">Disease</div>
            <div id="sumDz" class="value dash">—</div>
          </div>
        </div>
        <div class="footer">created by micah etter, md</div>
      </div>

      <!-- RIGHT: Interactive panel -->
      <div class="card">
        <svg class="flower fl1" viewBox="0 0 100 100" aria-hidden="true">
          <g stroke="var(--line)" stroke-width="6" fill="var(--violet)">
            <circle cx="50" cy="18" r="16"/><circle cx="82" cy="34" r="16"/>
            <circle cx="82" cy="66" r="16"/><circle cx="50" cy="82" r="16"/>
            <circle cx="18" cy="66" r="16"/><circle cx="18" cy="34" r="16"/>
            <circle cx="50" cy="50" r="14" fill="var(--sun)"/>
          </g>
        </svg>
        <div class="stage-tabs">
          <button class="tab active" data-stage="pace">• Pace</button>
          <button class="tab" data-stage="localization">Localization</button>
          <button class="tab" data-stage="etiology">Etiology</button>
          <button class="tab" data-stage="disease">Disease</button>
        </div>

        <div id="stageContent"></div>
      </div>
    </div>
  </div>

<script>
/** --------------- Data --------------- **/
const PACE_TIME = ["Hyperacute","Acute","Subacute","Chronic"];
const PACE_PATTERN = ["Unknown","Monophasic","Relapsing","Stepwise","Progressive"]; // picker shows "Unknown"; summary shows — until set

// Hierarchical localization (CNS + PNS)
const LOCALIZATION_GROUPS = [
  { header: "Central nervous system", sections: [
    { title: "Cerebral hemisphere", items: ["Cortex","Subcortical white matter","Basal ganglia","Thalamus"] },
    { title: "Brainstem", items: ["Midbrain","Pons","Medulla"] },
    { title: "Cerebellum", items: ["Hemisphere","Midline"] },
    { title: "Spinal cord", items: ["Corticospinal tracts","Spinothalamic tracts","Dorsal columns"] },
    { title: "Spinal roots", items: ["Cervical","Thoracic","Lumbar"] },
  ]},
  { header: "Peripheral nervous system", sections: [
    { title: "Dorsal root ganglia", items: ["Dorsal root ganglia"] },
    { title: "Plexus", items: ["Brachial","Lumbosacral"] },
    { title: "Peripheral nerves", items: [
      "Median","Ulnar","Radial","Musculocutaneous","Axillary",
      "Femoral","Sciatic","Tibial","Peroneal","Sural"
    ]},
    { title: "Neuromuscular junction", items: ["Neuromuscular junction"] },
    { title: "Muscle", items: ["Muscle"] },
  ]},
];

// Example case (edit/replace with CSV wiring)
const currentCase = {
  prompt: "68-year-old with sudden, minutes-old dysarthria, ataxia, and internuclear ophthalmoplegia/abducens findings after abrupt onset during routine activity; BP elevated on arrival.",
  pace_timecourse: "Hyperacute",
  pace_pattern: "Monophasic",
  localization: "Pons",
  etiology: null,
  disease: null
};

/** --------------- State --------------- **/
const picked = { pace_timecourse: null, pace_pattern: null, localization: [], etiology: null, disease: null };
const locked = { pace: false, localization: false, etiology: false, disease: false };
const wrong = { pace_timecourse: new Set(), pace_pattern: new Set(), localization: new Set() };

const norm = s => (s||"").toString().trim().toLowerCase();
const qs = (sel, root=document)=>root.querySelector(sel);
const qsa = (sel, root=document)=>[...root.querySelectorAll(sel)];

/** --------------- UI Helpers --------------- **/
function setTab(stage){
  qsa('.tab').forEach(t => t.classList.toggle('active', t.dataset.stage === stage));
  renderStage(stage);
}

function updateSummary(){
  qs('#sumPace').textContent = locked.pace ? (picked.pace_timecourse || "—") : "—";
  qs('#sumPace').classList.toggle('dash', !locked.pace || !picked.pace_timecourse);
  qs('#sumPattern').textContent = locked.pace ? (picked.pace_pattern || "—") : "—";
  qs('#sumPattern').classList.toggle('dash', !locked.pace || !picked.pace_pattern);
  qs('#sumLoc').textContent = locked.localization ? (picked.localization.length ? picked.localization.join(", ") : "—") : "—";
  qs('#sumLoc').classList.toggle('dash', !locked.localization || picked.localization.length===0);
  qs('#sumEti').textContent = locked.etiology ? (picked.etiology || "—") : "—";
  qs('#sumEti').classList.toggle('dash', !locked.etiology || !picked.etiology);
  qs('#sumDz').textContent = locked.disease ? (picked.disease || "—") : "—";
  qs('#sumDz').classList.toggle('dash', !locked.disease || !picked.disease);
}

function chip(base, {active=false, disabled=false, correct=false, wrong=false}={}){
  const btn = document.createElement('button');
  btn.className = 'chip';
  if(active) btn.classList.add('active');
  if(disabled) btn.classList.add('disabled');
  if(correct) btn.classList.add('correct');
  if(wrong) btn.classList.add('wrong');
  btn.textContent = base;
  return btn;
}

// Pace helpers
function isPaceCorrect(opt){
  if(!picked.pace_timecourse || norm(picked.pace_timecourse)!==norm(opt)) return false;
  return norm(currentCase.pace_timecourse) === norm(opt);
}
function isPaceWrong(opt){
  return wrong.pace_timecourse.has(opt) ||
         (picked.pace_timecourse===opt && norm(currentCase.pace_timecourse)!==norm(opt));
}

// Pattern helpers
function isPatternCorrect(opt){
  if(!picked.pace_pattern || norm(picked.pace_pattern)!==norm(opt)) return false;
  if(!currentCase.pace_pattern) return false;
  return norm(currentCase.pace_pattern) === norm(opt);
}
function isPatternWrong(opt){
  return wrong.pace_pattern.has(opt) ||
         (picked.pace_pattern===opt && currentCase.pace_pattern && norm(currentCase.pace_pattern)!==norm(opt));
}

// Localization helpers
function isLocWrong(opt){
  const correct = norm(currentCase.localization);
  const chosen = picked.localization.some(l => norm(l)===norm(opt));
  return wrong.localization.has(opt) || (chosen && norm(opt)!==correct);
}
function isLocCorrect(opt){
  const correct = norm(currentCase.localization);
  return picked.localization.some(l => norm(l)===norm(opt)) && norm(opt)===correct;
}

/** --------------- Stage Renderers --------------- **/
function renderPace(){
  const root = document.createElement('div');

  // Timecourse
  const g1 = document.createElement('div'); g1.className='group';
  g1.innerHTML = '<div class="section-title">Timecourse</div>';
  const row1 = document.createElement('div'); row1.className='options';
  PACE_TIME.forEach(opt => {
    const btn = chip(opt, { active: picked.pace_timecourse===opt, correct: isPaceCorrect(opt), wrong: isPaceWrong(opt) });
    btn.onclick = () => {
      picked.pace_timecourse = opt;
      if(norm(opt)!==norm(currentCase.pace_timecourse)) wrong.pace_timecourse.add(opt);
      updateSummary(); setTab('pace');
    };
    row1.appendChild(btn);
  });
  g1.appendChild(row1); root.appendChild(g1);

  // Pattern
  const g2 = document.createElement('div'); g2.className='group';
  g2.innerHTML = '<div class="section-title">Pattern</div>';
  const row2 = document.createElement('div'); row2.className='options';
  PACE_PATTERN.forEach(opt => {
    const btn = chip(opt, { active: picked.pace_pattern===opt, correct: isPatternCorrect(opt), wrong: isPatternWrong(opt) });
    btn.onclick = () => {
      picked.pace_pattern = opt;
      if(currentCase.pace_pattern && norm(opt)!==norm(currentCase.pace_pattern)) wrong.pace_pattern.add(opt);
      updateSummary(); setTab('pace');
    };
    row2.appendChild(btn);
  });
  g2.appendChild(row2); root.appendChild(g2);

  const ctr = document.createElement('div'); ctr.className='controls';
  const lock = document.createElement('button'); lock.className='btn'; lock.textContent='Paced!';
  lock.disabled = !picked.pace_timecourse;
  lock.onclick = () => { locked.pace = true; updateSummary(); setTab('localization'); };
  ctr.appendChild(lock); root.appendChild(ctr);
  return root;
}

function renderLocalization(){
  const root = document.createElement('div');

  LOCALIZATION_GROUPS.forEach(group => {
    const h = document.createElement('div'); h.className='section-header'; h.textContent = group.header;
    root.appendChild(h);
    group.sections.forEach(sec => {
      const t = document.createElement('div'); t.className='section-title'; t.textContent = sec.title;
      root.appendChild(t);
      const row = document.createElement('div'); row.className='options';
      sec.items.forEach(opt => {
        const btn = chip(opt, { active: picked.localization.includes(opt), correct: isLocCorrect(opt), wrong: isLocWrong(opt) });
        btn.onclick = () => {
          picked.localization = [opt]; // single-select behavior
          if(norm(opt)!==norm(currentCase.localization)) wrong.localization.add(opt);
          updateSummary(); setTab('localization');
        };
        row.appendChild(btn);
      });
      root.appendChild(row);
    });
  });

  const ctr = document.createElement('div'); ctr.className='controls';
  const lock = document.createElement('button'); lock.className='btn'; lock.textContent='Localized!';
  lock.disabled = picked.localization.length===0;
  lock.onclick = () => { locked.localization = true; updateSummary(); setTab('etiology'); };
  ctr.appendChild(lock); root.appendChild(ctr);
  return root;
}

function renderEtiology(){
  const root = document.createElement('div');
  root.innerHTML = '<div class="section-title">Etiology (placeholder)</div>';
  const ctr = document.createElement('div'); ctr.className='controls';
  const lock = document.createElement('button'); lock.className='btn'; lock.textContent='Etiology!';
  lock.onclick = () => { locked.etiology = true; updateSummary(); setTab('disease'); };
  ctr.appendChild(lock); root.appendChild(ctr);
  return root;
}

function renderDisease(){
  const root = document.createElement('div');
  root.innerHTML = '<div class="section-title">Disease (placeholder)</div>';
  const ctr = document.createElement('div'); ctr.className='controls';
  const lock = document.createElement('button'); lock.className='btn'; lock.textContent='Diagnosed!';
  lock.onclick = () => { locked.disease = true; updateSummary(); alert('Groovy! Diagnosis made.'); };
  ctr.appendChild(lock); root.appendChild(ctr);
  return root;
}

function renderStage(stage){
  const target = qs('#stageContent');
  target.innerHTML = '';
  if(stage==='pace') target.appendChild(renderPace());
  else if(stage==='localization') target.appendChild(renderLocalization());
  else if(stage==='etiology') target.appendChild(renderEtiology());
  else target.appendChild(renderDisease());
}

// Init
function init(){
  qs('#caseBox').textContent = currentCase.prompt;
  updateSummary();
  setTab('pace');
  qsa('.tab').forEach(btn => btn.onclick = () => setTab(btn.dataset.stage));
}
init();
</script>
</body>
</html>
